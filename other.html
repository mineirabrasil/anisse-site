<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Johanna, Thais">
    <meta name="Description" content="In which I babble about pet projects and rant about stuff I like. Linux engineer by day, I probably play too much video games on my occasional free time."> <!--description appears in search engine-->
    <meta name="keyword" content="CSS, website, html">
    <title>Linux Engineer's random thoughts</title>
    <link rel="shortcut icon" type="image/x-icon" href="./images/favico/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="./images/favico/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./images/favico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./images/favico/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="36x36" href="./images/favico/android-icon-36x36.png">
    <link rel="icon" type="image/png" sizes="48x48" href="./images/favico/android-icon-48x48.png">
    <link rel="icon" type="image/png" sizes="72x72" href="./images/favico/android-icon-72x72.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./images/favico/android-icon-96x96.png">
    <link rel="icon" type="image/png" sizes="144x144" href="./images/favico/android-icon-144x144.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./images/favico/android-icon-192x192.png">
    <link rel="apple-touch-icon" sizes="57x57" href="./images/favico/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./images/favico/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./images/favico/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./images/favico/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./images/favico/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./images/favico/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./images/favico/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./images/favico/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./images/favico/apple-icon-180x180.png">
    <link rel="apple-touch-icon-precomposed" sizes="192x192" href="./images/favico/apple-icon.png">
    <link rel="apple-touch-icon-precomposed" sizes="192x192" href="./images/favico/apple-icon-precomposed.png">
</head>
<body>
    <header>
        <ul>
            <li><a href="./index.html">home</a></li>
            <li>Archives</li>
            <li><a href="https://github.com/anisse/">Projects</a></li>
        </ul>
    </header>
    <aside>
        <header>
            <h1><a href="./index.html">Anisse Astier</a></h1>
            <h2><a href="./index.html">Linux Engineer's random thoughts</a></h2>
        </header>
        <img src="images/anisse.jpg" alt="photo de l'auteur"/>
        <p>In which I babble about pet projects and rant about stuff I like. Linux engineer by day, I probably play too much video games on my occasional free time.</p>
        <nav>
            <ul>
                <li><a href="https://anisse.astier.eu/feed/">Rss</a></li>
                <li>
                    <address>
                        <a href="mailto:anisse@astier.eu">Email!</a>
                    </address>
                </li>
                <li><a href="https://twitter.com/Aissn">Twitter</a></li>
                <li><a href="https://github.com/anisse">GitHub projects</a></li>
                <li><a href="http://fr.linkedin.com/in/astier">Linkedin</a></li>
                <li><a href="http://www.amazon.fr/registry/wishlist/26EH84J5E46R3">Amazon wishlist</a></li>
            </ul>
        </nav>
    </aside>
    <main>
        <article>
            <h1>Blog update</h1>
            <p>November 14, 2020</p>
            <p>I recently updated the server where this blog is hosted, so I tought I'd do an update on the <a href="./other.html">original post</a> explaining the tech stack used to run it. Once in seven years shouldn't be too meta.</p>
            <h2>The design</h2>
            <p>First of all, kudos to <a href="https://www.linkedin.com/in/pascalnaviere/">Pascal Navière</a>, a very talented polymath that did the design of this site(CSS, DOM structure, etc.), which I then modified. All bugs are therefore my own additions.</p>
            <p>Since launch, Pascal has found a career in software engineering. He has so many tricks up his sleeve, you would be surprised. But it's not my place to tell his story.</p>
            <p>What I failed to mention initially, was all the icons done in CSS art, which was pretty rare at the time, and secret superpower of Pascal's. The icons are on the left (or bottom for lower resolutions), and in the share bar at the bottom of every article; some of which might be blocked by uBlock lists, and I decided to not work around it. Despite being very careful not load any external resource (other than the font(update 2021-02-07: I got rid of the third-party font request, it's <a href="https://developers.google.com/web/updates/2020/10/http-cache-partitioning">now useless anyway</a> it's not my place to decide if someone thinks the share bar is an annoyance or not.</p>
            <p>There's no use for the <a href="https://en.wikipedia.org/wiki/Google%2B">Google+</a> icon anymore, so it has been retired. But if you look into the CSS, you can find it with the others.</p>
            <p>At the beginning there also wasn't any pagination: I did not deem it necessary with only one article, despite it being in Pascal's original design. I added it later to the templates.</p>
            <h2>The tech</h2>
            <p>The DNS you used to access this website is still hosted by <a href="https://www.gandi.net/fr">gandi</a> The website itself resides on a <a href="https://www.scaleway.com/fr/">Scaleway</a> Stardust instance, more than sufficient for my needs, and currently the cheapest virtual private server in the world. The SSL certificate has been provided by <a href="https://letsencrypt.org/">Lets's Encrypt</a> for many years now.</p>
            <p>On this VPS, <a href="https://ubuntu.com/">Ubuntu</a> 20.04 LTS, with <a href="http://nginx.org/">nginx</a> serving the actual pages.</p>
            <p>Pages which are all old school static <a href="https://html.spec.whatwg.org/">HTML</a>, generated by the venerable <a href="https://docs.getpelican.com/en/latest/">Pelican</a> currently at version 4.5.0. I've thought multiple times about moving to another engine like <a href="https://gohugo.io/">Hugo</a> or <a href="https://www.getzola.org/">Zola</a>, but none has all the features I need (like <a href="https://pypi.org/project/pelican-webassets/">Pelican webassets</a> which compiles the CSS into a bundle), and I'm too lazy to port the templates anyway.</p>
            <p>On my machine pelican is run with <a href="https://www.python.org/">python</a> 3.8.6, in a <a href="https://docs.python.org/3/library/venv.html#creating-virtual-environments">venv</a> where <a href="https://pip.pypa.io/en/stable/">pip was installed</a>. The content is edited with <a href="https://vim.org/">vim</a> on <a href="https://getfedora.org/">Fedora</a> 32.</p> <!--Vim link not working -->
            <p>Over the years, I did some experiments, like compiling nginx with the <a href="https://developers.google.com/speed/pagespeed/module">Pagespeed plugin</a>, but I've moved back to distro builds since maintaining it wasn't worth the hassle. The website is still served over <a href="https://en.wikipedia.org/wiki/HTTP/2">HTTP/2</a>, and supports <a href="./other.html">IPv6</a>.</p>
            <p>Many years ago, I moved to Let's Encrypt instead of StartSSL. The later isn't trusted anymore by browsers <a href="https://en.wikipedia.org/wiki/StartCom#Trustworthiness">after some woes</a>. I initially settled for <a href="https://github.com/kuba/simp_le">simp_le</a> as an <a href="https://en.wikipedia.org/wiki/Automated_Certificate_Management_Environment">ACME</a> client, and deployed it with ansible using <a href="https://github.com/L-P/ansible-role-simp_le">L-P's role</a>. It has served me well over the last (almost four) years, but isn't maintained anymore, and simp_le doesn't support the latest version of the protocol, <a href="https://tools.ietf.org/html/rfc8555">ACMEv2</a>.</p>
            <p>As I moved to a new server, I wanted all software to be automatically deployed with <a href="https://docs.ansible.com/ansible/latest/index.html">ansible</a>.</p>
            <p>I had a look at <a href="https://github.com/hlandau/acmetool">acmetool</a>. Since there's no official acmetool build with the latest version; I did not want to install go on the server, however trivial it might seem, and handle the updating myself. Ditto for trusting a third-party repo. The acmetool version is the distro repos does not support ACMEv2, so I wouldn't be able to get a new certificate, and renewal would stop working in 2021. Therefore I chose to use <a href="https://certbot.eff.org/">certbot</a> the original ACME client.</p>
            <p>I initially wanted to use a third party ansible role to simplify deployment, so I then settled on both <a href="https://github.com/geerlingguy/ansible-role-nginx">nginx</a> and <a href="https://github.com/geerlingguy/ansible-role-certbot">certbot</a> roles from <a href="https://www.jeffgeerling.com/">Jeff Geerling</a>. I successfully used those to deploy a test site, but was unsatisfied with how complex it was. I had to patch the vendored nginx role to add IPv6 support, and it deployed the redirects using separate files. It all seemed to complex for only one website; a task that could be done with a single <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html">ansible template</a> and an apt rule. In addition, the certbot role did not support the nginx plugin, so I rewrote it all, and removed the vendored roles.</p>
            <p>The <a href="https://certbot.eff.org/instructions">recommended way to install certbot</a> on all Linux distros is to use <a href="https://snapcraft.io/docs/installing-snapd">snapd</a>; and while I understand why they chose this approach (software is always up-to-date, and they control the deployment), snapd is a resource-hog which I had already disabled. So I decided to install certbot and certbot-nginx via pip, and keep them up-to-date automatically with a cron job. That makes a compromised <a href="https://pypi.org/">PyPI</a> a point of failure of this server, but I already trust them anyway.</p>
            <p>In the end, nginx 1.18.0 (from Ubuntu) and certbot 1.9.0 (from PyPI) are both deployed with ansible 2.10.3, with python 3.8.5 (also from Ubuntu) on the server.</p>
        </article>
        <section>
            <p>Share</p>
            <nav>
                <ul>
                    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fanisse.astier.eu%2Fblog-update.html" title="Share on Facebook">Facebook</a></li>
                    <li><a href="https://twitter.com/intent/tweet?text=Blog%20update&url=https%3A%2F%2Fanisse.astier.eu%2Fblog-update.html" title="Share on Twitter">Twitter</a></li>
                    <li><a href="https://www.blogger.com/blog-this.g" title="Share on Blogger">Blogger</a></li>
                    <li><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fanisse.astier.eu%2Fblog-update.html" title="Share on Linkedin" >Linkedin</a></li>
                    <li><a href="https://news.ycombinator.com/submitlink?t=Blog%20update&u=https%3A//anisse.astier.eu/blog-update.html" title="Share on Hacker News">Hacker News</a></li>
                    <li><a href="https://www.reddit.com/submit?url=https%3A//anisse.astier.eu/blog-update.html" title="Share on Reddit">Reddit</a></li>
                </ul>
            </nav>
        </section>
    </main>
    <footer>
        <p>Built with <a href="https://docs.getpelican.com/en/latest/">pelican</a> - <a href="./other.html">web design by Navière Pascal</a></p>
    </footer>      
</body>
</html>
